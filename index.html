<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discord Analytics Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.min.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); color: #e0e0e0; min-height: 100vh; padding: 20px; line-height: 1.6; }
.container { max-width: 1400px; margin: 0 auto; }
header { text-align: center; margin-bottom: 40px; padding: 30px 20px; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1); }
h1 { font-size: 3em; margin-bottom: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.subtitle { color: #a0a0a0; font-size: 1.1em; }
.last-updated { margin-top: 15px; font-size: 0.9em; color: #667eea; font-weight: 500; }
.toggle-container { display: flex; justify-content: center; align-items: center; gap: 15px; margin: 20px 0; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; }
.toggle-label { font-size: 1.1em; font-weight: 600; color: #a0a0a0; transition: color 0.3s; }
.toggle-label.active { color: #667eea; }
.toggle-switch { position: relative; width: 60px; height: 30px; background: rgba(255, 255, 255, 0.1); border-radius: 15px; cursor: pointer; transition: background 0.3s; }
.toggle-switch.active { background: #667eea; }
.toggle-slider { position: absolute; top: 3px; left: 3px; width: 24px; height: 24px; background: white; border-radius: 50%; transition: transform 0.3s; }
.toggle-switch.active .toggle-slider { transform: translateX(30px); }
.status-banner { padding: 15px; border-radius: 10px; margin-bottom: 30px; text-align: center; font-weight: 500; display: none; }
.status-banner.success { background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(76, 175, 80, 0.5); color: #81c784; display: block; }
.status-banner.error { background: rgba(244, 67, 54, 0.2); border: 1px solid rgba(244, 67, 54, 0.5); color: #e57373; display: block; }
.status-banner.loading { background: rgba(33, 150, 243, 0.2); border: 1px solid rgba(33, 150, 243, 0.5); color: #64b5f6; display: block; }
.dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
@media (max-width: 1024px) { .dashboard-grid { grid-template-columns: 1fr; } h1 { font-size: 2em; } }
.card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; border: 1px solid rgba(255, 255, 255, 0.1); transition: transform 0.3s ease; }
.card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
.card-header { display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid rgba(102, 126, 234, 0.3); }
.card-icon { font-size: 2em; margin-right: 15px; }
.card-title { font-size: 1.5em; font-weight: 600; color: #ffffff; }
.word-cloud-container { grid-column: 1 / -1; }
#wordCloud { width: 100%; height: 400px; background: rgba(0, 0, 0, 0.2); border-radius: 10px; }
.word-list, .skull-list, .leaderboard-list { list-style: none; max-height: 600px; overflow-y: auto; }
.word-list::-webkit-scrollbar, .skull-list::-webkit-scrollbar, .leaderboard-list::-webkit-scrollbar { width: 8px; }
.word-list::-webkit-scrollbar-track, .skull-list::-webkit-scrollbar-track, .leaderboard-list::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.2); border-radius: 10px; }
.word-list::-webkit-scrollbar-thumb { background: rgba(102, 126, 234, 0.5); border-radius: 10px; }
.skull-list::-webkit-scrollbar-thumb { background: rgba(118, 75, 162, 0.5); border-radius: 10px; }
.leaderboard-list::-webkit-scrollbar-thumb { background: rgba(255, 193, 7, 0.5); border-radius: 10px; }
.word-item, .skull-item, .leaderboard-item { display: flex; align-items: center; padding: 12px 15px; margin-bottom: 10px; background: rgba(255, 255, 255, 0.03); border-radius: 8px; transition: all 0.3s ease; border-left: 3px solid transparent; }
.word-item:hover { background: rgba(102, 126, 234, 0.1); border-left-color: #667eea; transform: translateX(5px); }
.skull-item:hover { background: rgba(118, 75, 162, 0.1); border-left-color: #764ba2; transform: translateX(5px); }
.leaderboard-item:hover { background: rgba(255, 193, 7, 0.1); border-left-color: #ffc107; transform: translateX(5px); }
.word-rank, .leaderboard-rank { font-size: 1.2em; font-weight: bold; color: #667eea; min-width: 40px; }
.leaderboard-rank { color: #ffc107; }
.word-text, .leaderboard-author { flex: 1; font-size: 1.1em; font-weight: 500; color: #ffffff; }
.word-count, .leaderboard-skulls { font-size: 1em; font-weight: bold; color: #667eea; background: rgba(102, 126, 234, 0.2); padding: 5px 15px; border-radius: 20px; }
.leaderboard-skulls { color: #ffc107; background: rgba(255, 193, 7, 0.2); }
.skull-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.skull-author { font-weight: 600; color: #764ba2; }
.skull-count { font-size: 1.2em; font-weight: bold; color: #764ba2; background: rgba(118, 75, 162, 0.2); padding: 5px 15px; border-radius: 20px; }
.skull-content { color: #b0b0b0; font-size: 0.95em; line-height: 1.5; word-wrap: break-word; }
.loading, .empty-state, .error-state { text-align: center; padding: 40px 20px; color: #808080; font-size: 1.1em; }
.loading::before { content: "‚è≥ "; font-size: 2em; display: block; margin-bottom: 15px; }
.empty-state::before { content: "üì≠ "; font-size: 2em; display: block; margin-bottom: 15px; }
.error-state { color: #e57373; }
.error-state::before { content: "‚ö†Ô∏è "; font-size: 2em; display: block; margin-bottom: 15px; }
footer { text-align: center; margin-top: 50px; padding: 20px; color: #808080; font-size: 0.9em; }
</style>
</head>
<body>
<div class="container">
<header>
<h1>üíÄ Discord Analytics</h1>
<p class="subtitle">Real-time server statistics & word trends</p>
<div class="toggle-container">
<span class="toggle-label active" id="labelAllTime">All Time</span>
<div class="toggle-switch" id="timeToggle" onclick="toggleTimeFilter()">
<div class="toggle-slider"></div>
</div>
<span class="toggle-label" id="labelToday">Today</span>
</div>
<div class="last-updated" id="lastUpdated"></div>
</header>

<div class="status-banner" id="statusBanner"></div>

<div class="dashboard-grid">
<div class="card word-cloud-container">
<div class="card-header">
<span class="card-icon">‚òÅÔ∏è</span>
<h2 class="card-title">Word Cloud</h2>
</div>
<canvas id="wordCloud"></canvas>
</div>

<div class="card">
<div class="card-header">
<span class="card-icon">üìä</span>
<h2 class="card-title">Top 20 Words</h2>
</div>
<ul class="word-list" id="wordList">
<li class="loading">Loading word data...</li>
</ul>
</div>

<div class="card">
<div class="card-header">
<span class="card-icon">üíÄ</span>
<h2 class="card-title">Top Skull Reactions</h2>
</div>
<ul class="skull-list" id="skullList">
<li class="loading">Loading skull reactions...</li>
</ul>
</div>

<div class="card">
<div class="card-header">
<span class="card-icon">üèÜ</span>
<h2 class="card-title">Member Leaderboard</h2>
</div>
<ul class="leaderboard-list" id="leaderboardList">
<li class="loading">Loading leaderboard...</li>
</ul>
</div>
</div>

<footer>
<p>Discord Analytics Dashboard ‚Ä¢ Auto-refreshes every 30 seconds</p>
<p>Powered by Flask API + GitHub Pages</p>
</footer>
</div>

<script>
const API_URL = 'https://0f0edccbf5b0a714-131-226-106-102.serveousercontent.com';
const REFRESH_INTERVAL = 30000;
let showTodayOnly = false;
let refreshTimer = null;

function showStatus(type, message) {
const banner = document.getElementById('statusBanner');
banner.className = `status-banner ${type}`;
banner.textContent = message;
}

function updateTimestamp() {
const now = new Date();
const timeString = now.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
const mode = showTodayOnly ? '(Today Only)' : '(All Time)';
document.getElementById('lastUpdated').textContent = `Last updated: ${timeString} ${mode}`;
}

function toggleTimeFilter() {
showTodayOnly = !showTodayOnly;
const toggle = document.getElementById('timeToggle');
const labelAllTime = document.getElementById('labelAllTime');
const labelToday = document.getElementById('labelToday');
if (showTodayOnly) {
toggle.classList.add('active');
labelAllTime.classList.remove('active');
labelToday.classList.add('active');
} else {
toggle.classList.remove('active');
labelAllTime.classList.add('active');
labelToday.classList.remove('active');
}
loadAllData();
}

async function fetchTopWords() {
const endpoint = showTodayOnly ? '/top-words-today' : '/top-words';
const response = await fetch(`${API_URL}${endpoint}?limit=20`);
if (!response.ok) throw new Error(`HTTP ${response.status}`);
const data = await response.json();
return data.top_words || [];
}

async function fetchTopSkulls() {
const endpoint = showTodayOnly ? '/top-skulls-today' : '/top-skulls';
const params = showTodayOnly ? '?limit=10' : '?limit=10&days=7';
const response = await fetch(`${API_URL}${endpoint}${params}`);
if (!response.ok) throw new Error(`HTTP ${response.status}`);
const data = await response.json();
return data.messages || [];
}

async function fetchMemberLeaderboard() {
const response = await fetch(`${API_URL}/member-leaderboard?limit=10`);
if (!response.ok) throw new Error(`HTTP ${response.status}`);
const data = await response.json();
return data.leaderboard || [];
}

function renderWordList(words) {
const wordList = document.getElementById('wordList');
if (words.length === 0) {
wordList.innerHTML = '<li class="empty-state">No words yet.<br>Start chatting!</li>';
return;
}
wordList.innerHTML = '';
words.forEach((item, index) => {
const li = document.createElement('li');
li.className = 'word-item';
li.innerHTML = `<span class="word-rank">#${index + 1}</span><span class="word-text">${item.word}</span><span class="word-count">${item.count}</span>`;
wordList.appendChild(li);
});
}

function renderWordCloud(words) {
const canvas = document.getElementById('wordCloud');
if (words.length === 0) return;
const wordCloudData = words.map(item => [item.word, item.count]);
WordCloud(canvas, {
list: wordCloudData,
gridSize: 8,
weightFactor: size => Math.pow(size, 0.5) * 15,
fontFamily: 'Arial, sans-serif',
color: () => {
const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b'];
return colors[Math.floor(Math.random() * colors.length)];
},
rotateRatio: 0.3,
rotationSteps: 2,
backgroundColor: 'transparent',
drawOutOfBound: false,
shrinkToFit: true
});
}

function renderSkullList(messages) {
const skullList = document.getElementById('skullList');
if (messages.length === 0) {
skullList.innerHTML = '<li class="empty-state">No skull reactions yet.</li>';
return;
}
skullList.innerHTML = '';
messages.forEach(msg => {
const li = document.createElement('li');
li.className = 'skull-item';
const content = msg.content.length > 150 ? msg.content.substring(0, 150) + '...' : msg.content;
const safeContent = content.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
const safeAuthor = msg.author.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
li.innerHTML = `<div class="skull-header"><span class="skull-author">${safeAuthor}</span><span class="skull-count">üíÄ ${msg.skull_count}</span></div><div class="skull-content">${safeContent}</div>`;
skullList.appendChild(li);
});
}

function renderMemberLeaderboard(members) {
const leaderboardList = document.getElementById('leaderboardList');
if (members.length === 0) {
leaderboardList.innerHTML = '<li class="empty-state">No leaderboard data yet.</li>';
return;
}
leaderboardList.innerHTML = '';
members.forEach((member, index) => {
const li = document.createElement('li');
li.className = 'leaderboard-item';
let rank = `#${index + 1}`;
if (index === 0) rank = 'ü•á';
else if (index === 1) rank = 'ü•à';
else if (index === 2) rank = 'ü•â';
const safeAuthor = member.author.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
li.innerHTML = `<span class="leaderboard-rank">${rank}</span><span class="leaderboard-author">${safeAuthor}</span><span class="leaderboard-skulls">üíÄ ${member.skulls}</span>`;
leaderboardList.appendChild(li);
});
}

async function loadAllData() {
showStatus('loading', '‚è≥ Fetching data from API...');
try {
const [words, skulls, leaderboard] = await Promise.all([fetchTopWords(), fetchTopSkulls(), fetchMemberLeaderboard()]);
renderWordList(words);
renderWordCloud(words);
renderSkullList(skulls);
renderMemberLeaderboard(leaderboard);
updateTimestamp();
showStatus('success', '‚úì Data loaded successfully');
setTimeout(() => document.getElementById('statusBanner').style.display = 'none', 3000);
} catch (error) {
console.error('Failed to load data:', error);
showStatus('error', `‚ö†Ô∏è Failed to connect to API`);
document.getElementById('wordList').innerHTML = `<li class="error-state">Error: ${error.message}</li>`;
document.getElementById('skullList').innerHTML = `<li class="error-state">Error: ${error.message}</li>`;
document.getElementById('leaderboardList').innerHTML = `<li class="error-state">Error: ${error.message}</li>`;
}
}

function startAutoRefresh() {
if (refreshTimer) clearInterval(refreshTimer);
refreshTimer = setInterval(() => {
console.log('Auto-refreshing data...');
loadAllData();
}, REFRESH_INTERVAL);
}

document.addEventListener('DOMContentLoaded', () => {
console.log('Discord Analytics Dashboard initialized');
if (API_URL.includes('your-serveo-url')) {
showStatus('error', '‚ö†Ô∏è Please configure your API URL');
return;
}
loadAllData();
startAutoRefresh();
});

window.addEventListener('beforeunload', () => {
if (refreshTimer) clearInterval(refreshTimer);
});
</script>
</body>
</html>
